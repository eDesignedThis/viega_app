function page_checkout_address_show(){var a=sessionStorage.getItem(getBase()+"checkout.hasISPU");"true"==a&&$("#checkout_address_ispu").show(),getJson("CHECKOUT.ADDRESS.GET",HandleGetCheckoutAddress)}function HandleGetCheckoutAddress(a){var b="<strong>"+a.Name+"</strong><br/>"+a.Address.StreetAddress1+"<br/>";""!=a.Address.StreetAddress2&&(b+=a.Address.StreetAddress2+"<br/>"),b+=a.Address.CityName+", "+a.Address.StateCode+"  "+a.Address.PostalCode+"  "+a.Address.CountryCode+"<br/>"+a.Address.PhoneNumber+"<br/>"+a.Email+"<br/>";var c=$("#div_checkout_address");c.html(b),psg.setSessionItem("checkoutAddress",JSON.stringify(a))}function page_checkout_confirm_show(){getJson("SHOPPING.SHOPPINGCARTITEMS",HandleGetConfirm),$("#psg_checkout_confirm_button").click(HandlePurchaseButtonClick)}function HandleGetConfirm(a){var b="",c=0,d=0;$.each(a,function(a,e){var f=!1;if(d+=e.ExtendedPoints,c=e.PointBalance,null!=e.SelectedOrderOptions&&e.SelectedOrderOptions.indexOf("DELIVERYMETHOD=ISPU")>-1&&(f=!0),b+='<li><img class="ui-product-thumbnail" src="'+e.ItemSmallImageUrlFullyQualified+'"/>		<h2 id="title_'+e.CatalogItemId+'" class="ui-no-ellipse">'+e.ItemName+'</h2>		<p class="ui-paragraph-padding"><span class="shopPtsStyle">'+e.ExtendedPointsFormatted+' </span>points</p> 		<div class="ui-text-small">Quantity: '+e.Quantity+"</div>",f){var g="Select Store";null!=e.InStorePickUp&&null!=e.InStorePickUp.StoreId?(g="Change Store",b+="<div>Pickup at "+e.InStorePickUp.StoreName):b+='<span class="checkout-confirm-nostore"></span>',b+='<div class="ui-paragraph-padding psg-cg" data-role="controlgroup" data-type="horizontal" data-mini="true"> 			<button data-psg-points="'+e.PointsPerUnitFormatted+'" data-psg-key="'+e.CatalogItemId+'" 			class="change-pickup-store ui-btn ui-btn-a ui-shadow ui-corner-all ui-first-child ui-last-child" >'+g+"</button> 			</div>"}b+="</li>"}),""==b&&(b="<li>No items in shopping cart.</li>",$("#psg_checkout_confirm_button").hide()),b='<li data-role="list-divider" class="headerDivider" data-theme="a">Confirm Order</li>'+b;var e=$("#psg-listview-checkout_confirm");e.html(b);var f=c-d,g=$("#page_checkout_confirm");e.listview("refresh"),$("#psg_checkout_confirm_total_points").html(addCommas(d)),$("#psg_checkout_confirm_remaining_points").html(addCommas(f)),g.find(".psg-cg").controlgroup().controlgroup("refresh"),g.find(".change-pickup-store").on("click",HandlePickupStoreButtonClick)}function HandlePickupStoreButtonClick(a){var b=$(a.target).attr("data-psg-key"),c=$("#title_"+b).html(),d=$(a.target).attr("data-psg-points");sessionStorage.setItem(getBase()+"ispu.title",c),sessionStorage.setItem(getBase()+"ispu.key",b),sessionStorage.setItem(getBase()+"ispu.points",d),$.mobile.changePage("ispuselect.html")}function HandlePurchaseButtonClick(){if($(".checkout-confirm-nostore").length)return void WriteError("You must select a store for one or more items.");if(!$("#checkout_checkbox").prop("checked")){var a=$("#checkout_confirm_error");return a.text("You must agree to the return policy."),void a.show()}getJson("CHECKOUT.CART.PURCHASE",function(a){null==a.Result||"success"==a.Result?(sessionStorage.setItem(getBase()+"checkout.orderNumber",a.OrderNumber),$.mobile.changePage("receipt.html")):WriteError(a.Result)})}function page_claim_history_show(){var a=psgClaimHistory.Filter.get();getJson("CLAIM.HISTORY.GET",function(a){a=psgClaimHistory.Data.prep(a),psgClaimHistory.Data.set(a);var b='<li data-theme="a"><a href="promotionhistory.html" data-transition="slide">More...</a></li>';if(psg.isNothing(a)||psg.isNothing(a.Claims))b+="<li>You have no claims or your claims are archived.</li>";else{var c=psgClaimHistory.getLastClaims(a.Claims);b+=psgClaimHistory.buildClaimList(c)}var d=$("#psg-listview-claimhistory");d.html(b),d.listview().listview("refresh"),$(".psg-claim-item").on("click",function(a){var b=$(a.delegateTarget).attr("psg-claim-id");psgClaimHistory.SelectedClaim.set(b)})},a)}function page_claim_detail_show(){$("#psg-claim-detail-content").html("");var a=psgClaimHistory.SelectedClaim.get();return psg.isNothing(a)?void $("#psg-claim-detail-content").html('<p class="error"><strong>Yikes!</strong> Unable to retrieve the claim ID.</p><p class="ui-text-small">Try returning to the main menu and see if the problem corrects itself.</p>'):void getJson("CLAIM.DETAIL.GET",function(a){if(psg.isNothing(a)||psg.isNothing(a.Claim))return void $("#psg-claim-detail-content").html('<p class="error"><strong>Yikes!</strong> Your claim is unavailable or non-existent.</p><p>Check with your program administrator to see if the claim has been archived.</p>');var b="";b+=psgClaimHistory.buildClaimDetail(a.Claim),$("#psg-claim-detail-content").html(b),$("#psg-claim-detail-content").children(":jqmData(role=listview)").listview().listview("refresh")},{ClaimId:a})}function page_claim_show(){function a(a){if("success"==a.Result){psg.removeSessionItem("claim_id");var b=a.ClaimDetail[0];PreFillForm(b,"claim")}}function b(){var a=$("#frmClaim").serialize(),b=psg.getSessionItem("promotion_id"),d=JSON.stringify({form_contents:a,promotion_id:b});getJson("MOBILE.CLAIM.SAVE",c,d)}function c(a){"success"==a.Result?(psg.setSessionItem("claim_result_array",JSON.stringify(a.ResultArray)),$.mobile.pageContainer.pagecontainer("change","claimsconfirmation.html",{transition:"slide",changeHash:!1})):WriteError(!psg.isNothing(a.ResultArray)&&a.ResultArray.length>1?a.ResultArray[1]:a.Result)}var d=(psg.getSessionItem("promotion_id"),psg.getSessionItem("promotion_type_id")),e=psg.getSessionItem("promotion_name");$("#psg-claims-promotion-name").html(e);var f='PROMOTION_TYPES[PROMOTION_TYPE_ID="'+d+'"] FIELD',g=ParseFields("claim",f),h=$("#claim_form_div");h.html(g.html),h.append(g.script),$("#page_claim_content").trigger("create"),$("#frmClaim").validate({submitHandler:b});var i=psg.getSessionItem("claim_id");if(null!=i){var j=JSON.stringify({claim_id:i});getJson("CLAIM.DUPLICATE.GET",a,j)}}function PreFillForm(a,b){for(var c in a)if(null!=a[c]&&""!=a[c]){var d=$("#"+b+"_"+c);if(d.length&&(d.val(a[c]),d.is("select")&&d.selectmenu("refresh",!0),!d.is(":visible"))){if(e=$("#div_date_"+b+"_"+c),e.length){e.val(a[c]);continue}var e=$("#div_combo_"+b+"_"+c);if(e.length){var f=d.attr("data-psg-format"),g=c,h=c.replace("_code","_name"),i=c.replace("_code","_zip"),j="["+c+"]",k=j.replace("_code","_name"),l=j.replace("_code","_zip"),m=f;m=m.replace(j,a[g]),m=m.replace(k,a[h]),m=m.replace(l,a[i]),e.val(m);continue}}}}function ParseFields(a,b,c){"undefinded"==typeof c&&(c=!1);var d=psg.configXml,e=$(d),f="",g="",h=app.isPhoneGap;e.find(b).each(function(){var b=$(this);if(!c||"0"!=b.attr("CANEDIT")){var d=b.attr("TYPE"),e=b.attr("NAME"),i=b.attr("LABEL"),j=b.attr("SIZE"),k=0;psg.isNothing(j)||0/0==parseInt(j)||(k=parseInt(j),k>10?k=0:k+=.5);var l=b.attr("FIELD_PLACEHOLDER"),m=b.attr("REQUIRED"),n=b.attr("VALIDATION_MESSAGE"),o=b.text();if(m="1"==m?"required":"","hidden"==d)return void(f+='<input name="'+e+'"  type="hidden" value="" >');if("addressblock"==d)return void(f+=ExpandAddressBlock(a));switch("note"!=d&&(f+='<div class="ui-margin-top-1x"><label for="'+e+'">'+i+"</label>"),itemId=a+"_"+e,d){case"note":f+=undecorateCheckboxes(i);break;case"text2":case"text":var p=b.attr("ENABLESCAN");h&&"1"==p?(f+='<div class="ui-input-text ui-corner-all ui-body-inherit ui-shadow-inset ui-input-with-icon-container">',f+='<input data-enhanced="true" name="'+e+'" id="'+itemId+'" placeholder="'+l,f+='" data-wrapper-class="controlgroup-textinput ui-btn" type="text" ',k>0&&(f+=' style="width:'+j+'em;" '),m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),o&&(f+=' data-rule-regex="true" data-psg-validation="'+o+'" data-msg-regex="'+n+'" '),f+=">",f+='<a href="#" id="scan_'+itemId+'" class="fa fa-qrcode ui-menu-icon fa-lg fa-fw" style="margin:-14px .3125em 0;margin-right:5px;position:absolute;top:65%;right:0;"></a>',f+="</div>",g+='<script>app.initScanField("'+itemId+'");</script>'):(f+='<div class="ui-input-text ui-corner-all ui-body-inherit ui-shadow-inset"',k&&(f+=' style="width:'+k+'em;" '),f+=">",f+='<input data-enhanced="true" name="'+e+'" id="'+itemId+'" placeholder="'+l+'" type="text"',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),o&&(f+=' data-rule-regex="true" data-psg-validation="'+o+'" data-msg-regex="'+n+'" '),f+="></div>");break;case"lookup":case"lookup2":case"modellookup":case"modellookup2":var q=b.attr("LOOKUP_FIELDS"),r=b.attr("LOOKUP_FORMAT");f+='<div id="div_combo_'+itemId+'"></div><div id="toolTip_'+itemId+'"></div><input style="display:none;" data-role="none" type="text" id="'+itemId+'" name="'+e+'" ',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),f+=">",g+='<script>InitLookup("'+a+'","'+itemId+'","'+e+'","'+q+'","'+r+'","'+l+'");</script>';break;case"date":case"date2":f+='<input style="display:none;" type="text" data-role="none" id="'+itemId+'" name="'+e+'" ',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),f+='><div id="div_date_'+itemId+'"></div>',g+='<script>InitDate("'+itemId+'");</script>';break;case"select":f+='<select id="'+itemId+'" name="'+e+'" ',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),f+='><option value="">Select One</option>',b.find("OPTION").each(function(){var a=$(this);f+='<option value="'+a.attr("VALUE")+'">'+a.attr("TEXT")+"</option>"}),f+="</select>";break;case"checkbox":break;case"textarea":f+='<textarea id="'+itemId+'" name="'+e+'" placeholder="'+l+'" ',f+='onBlur="checkLen(this);" ',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),o&&(f+=' data-rule-regex="true" data-psg-validation="'+o+'" '),f+="></textarea>";break;case"picture":h?(f+='<input style="display:none;" data-role="none" name="'+e+'" id="'+itemId+'"  									type="text" ',m&&(f+=' data-rule-required="true" data-msg-required="'+i+' is required." '),f+='> 						<img id="img_'+itemId+'" style="width:250px;display:none">						<button id="picture_'+itemId+'" class="ui-btn ui-btn-a ui-icon-camera ui-btn-icon-right cancel ui-shadow ui-corner-all"  >Attach / Change Photo</button>',g+='<script>app.initPictureField("'+itemId+'");</script>'):f+='<input type="file" accept="image/*" capture name="'+e+'" id="'+itemId+'" placeholder="'+l+'">'}f+="</div>"}});var i={html:f,script:g};return i}function undecorateCheckboxes(a){return a.replace('type="checkbox"','type="checkbox" data-role="none"')}function InitLookup(a,b,c,d,e,f){var g=b,h=c,i=encodeURIComponent(psg.programGuid),j=d;(psg.isNothing(j)||"undefined"===j)&&(j="3");var k=f,l="["+h+"]",m=l.replace("_code","_name"),n=l.replace("_code","_zip"),o=e;(psg.isNothing(o)||"undefined"===o)&&(o=l+" "+m);var p=$("#div_combo_"+g),q=$("#"+g),r=$("#toolTip_"+g),s=psg.getSessionItem("promotion_id");q.attr("data-psg-format",o);var t={type:"GET",datatype:"json",datafields:[{name:"Code"},{name:"Name"},{name:"ZipCode"}],url:app.getHost()+"/json/JsonService.ashx",data:{action:a+"."+h.replace("_","")+"s.get",programGuid:i,fields:j,promotion_id:s}},u=new $.jqx.dataAdapter(t,{autoBind:!1,contentType:"application/json; charset=utf-8",formatData:function(a){return void 0!=p.jqxComboBox("searchString")?(a.filter=p.jqxComboBox("searchString"),a):void 0},beforeLoadComplete:function(a){return $.map(a,function(a){var b=o.replace(l,a.Code);return b=b.replace(m,a.Name),b=b.replace(n,a.ZipCode),{label:b,value:a.Code}})},loadComplete:function(){0==u.records.length&&r.jqxTooltip("open")},loadError:function(a){alert("Error: "+a.statusText)}});p.jqxComboBox({minLength:2,placeHolder:k,height:30,width:280,scrollBarSize:10,source:u,remoteAutoComplete:!0,remoteAutoCompleteDelay:500,valueMember:"value",displayMember:"label",searchMode:"containsignorecase",search:function(){u.dataBind()}}),r.jqxTooltip({content:"No Results",position:"right",autoHide:!0,trigger:"click",autoHideDelay:2500}),p.find("input:eq(0)").on("click",function(){$(this).select()});var v;p.on("select",function(a){a&&a.args&&a.args.item.value&&(v=a.args.item.value,q.val(v))})}function InitDate(a){var b=$("#div_date_"+a);b.jqxDateTimeInput({formatString:"MM/dd/yyyy",titleHeight:35,dropDownWidth:240,dropDownHeight:240,buttonSize:24,width:"115px",height:"30px",value:null}),b.on("valuechanged",function(b){if(null!=b&&null!=b.args&&null!=b.args.date){var c=b.args.date,d=$("#"+a);d.val(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear())}})}function page_claims_confirmation_show(){function a(){$("#psg-claims-confirmation-success-div").show(),$("#psg-claims-confirmation-audit-div").show(),$("#psg-claims-confirmation-new-claim-div").show()}function b(){$("#psg-claims-confirmation-success-div").hide(),$("#psg-claims-confirmation-audit-div").hide(),$("#psg-claims-confirmation-new-claim-div").hide()}function c(){$("#psg-claims-confirmation-success-div").hide(),$("#psg-claims-confirmation-audit-div").show()}function d(){$("#psg-claims-confirmation-success-div").show(),$("#psg-claims-confirmation-audit-div").hide()}a();var e=JSON.parse(psg.getSessionItem("claim_result_array"));if(psg.isNothing(e))return void b();var f=e[4];psg.isNothing(f)?d():c(),psg.setSessionItem("claim_id",e[2]),$(".psg-claims-confirmation-page-link").on("click",function(a){a.stopImmediatePropagation(),a.preventDefault(),$.mobile.pageContainer.pagecontainer("change",$(a.target).attr("href"),{transition:"slide",changeHash:!1,reverse:!0})})}function page_claims_landing_show(){function a(a){if(psg.isNothing(a))return'<li><p class="ui-no-ellipse error"><strong>There are no active promotions at this time.  Please check back later.</strong></p></li>';var b='<li><p class="ui-no-ellipse">Please select one of the following promotions:</p></li>';return $.each(a,function(a,c){b+='<li><a href="claims.html" class="psg-promotion-item" data-transition="slide" psg-promotion-id="',b+=c.promotion_id.toString(),b+='" psg-promotion-type-id="',b+=c.promotion_type_id.toString(),b+='"><div class="ui-no-ellipse ui-text-small"><strong>',b+=c.promotion_name,b+='</strong></div><div class="ui-text-small"><div class="ui-float-left">',b+=moment(c.sales_start_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+=" thru ",b+=moment(c.sales_end_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+='</div></div></a><a href="promotioninfo.html" class="psg-promotion-info-item" data-transition="slide" psg-promotion-id="',b+=c.promotion_id.toString(),b+='">Promotion Information</a></li>'}),b}getJson("CLAIM.PROMOTIONS.GET",function(b){psg.setSessionItem("claim.promotions",JSON.stringify(b.Promotions));var c=a(b.Promotions),d=$("#psg-listview-claimslanding");d.html(c).listview().listview("refresh"),d.find(".psg-promotion-item").on("click",function(a){var b=$(a.delegateTarget).attr("psg-promotion-id"),c=$(a.delegateTarget).attr("psg-promotion-type-id"),d=$.grep(JSON.parse(psg.getSessionItem("claim.promotions")),function(a){return!psg.isNothing(a)&&a.promotion_id==b});psg.removeSessionItem("claim_id"),psg.setSessionItem("promotion_id",b),psg.setSessionItem("promotion_type_id",c),psg.setSessionItem("promotion_name",psg.isNothing(d)?"":d[0].promotion_name),a.stopImmediatePropagation(),a.preventDefault(),$.mobile.pageContainer.pagecontainer("change","claims.html",{transition:"slide",changeHash:!1})}),d.find(".psg-promotion-info-item").on("click",function(a){var b=$(a.delegateTarget).attr("psg-promotion-id");psg.setSessionItem("promotion_id",b)})})}function page_contact_show(){$("#contact_subject_container").show(),$("#contact_question_container").show(),$("#contact_submit").show(),$("#contact_result").text(""),$("#contact_subject").change(function(){var a=$("#contact_other_subject_container"),b=$("#contact_other_subject");"Other"==$(this).find(":selected").val()?(a.show(),b.addClass("required")):(a.hide(),b.removeClass("required"))}),$("#form_contact").validate({submitHandler:submitContactForm})}function submitContactForm(){var a=JSON.stringify({subject:$("#contact_subject").val(),other:$("#contact_other_subject").val(),question:$("#contact_question").val()});getJson("SHOPPING.SHOPPINGCARTITEMS",HandleContactSubmit,a)}function HandleContactSubmit(a){if(null==a.Result||"success"==a.Result){var b=$("#contact_result");b.show(),$("#contact_subject_container").hide(),$("#contact_other_subject_container").hide(),$("#contact_other_subject_container").val(""),$("#contact_question_container").hide(),$("#contact_question_container").val(""),$("#contact_submit").hide(),b.text("Email Sucessfully Sent")}else WriteError(a.Result)}function page_edit_checkout_address_show(){var a=psg.getSessionItem("checkoutAddress");null===a?getJson("CHECKOUT.ADDRESS.GET",HandleEditCheckoutAddress):HandleEditCheckoutAddress(JSON.parse(a)),$("#frmEditCheckoutAddress").validate({submitHandler:doUpdateCheckoutAddress})}function HandleEditCheckoutAddress(a){$("#edit_checkout_name").val(a.Name),$("#edit_checkout_address1").val(a.Address.StreetAddress1),$("#edit_checkout_address2").val(a.Address.StreetAddress2),$("#edit_checkout_city").val(a.Address.CityName),$("#edit_checkout_state").val(a.Address.StateCode),$("#edit_checkout_zip").val(a.Address.PostalCode),$("#edit_checkout_country").val(a.Address.CountryCode),$("#edit_checkout_phone").val(a.Address.PhoneNumber),$("#edit_checkout_email").val(a.Email)}function doUpdateCheckoutAddress(){var a=JSON.stringify({Name:$("#edit_checkout_name").val(),StreetAddress1:$("#edit_checkout_address1").val(),StreetAddress2:$("#edit_checkout_address2").val(),CityName:$("#edit_checkout_city").val(),StateCode:$("#edit_checkout_state").val(),PostalCode:$("#edit_checkout_zip").val(),PhoneNumber:$("#edit_checkout_phone").val()});getJson("CHECKOUT.ADDRESS.SET",function(a){"success"==a.Result?history.back():(psg.setSessionItem("cartChangeDetails",a.ChangeDetails),$.mobile.pageContainer.pagecontainer("change","shoppingcart.html"))},a)}function page_enrollment_show(){function a(){var a=$("#password").val(),c=$("#password_confirm").val();if(a!=c)return ShowAlert("Passwords do not match.","Error"),!1;var d=$("#frmEnrollment").serialize(),e=psg.getSessionItem("participantKey"),f=null;f=JSON.stringify(null==e?{form_contents:d,guid:psg.programGuid}:{form_contents:d,guid:psg.programGuid,participant_key:e}),getJson("MOBILE.ENROLLMENT.SAVE",b,f)}function b(a){null==a.Result||"success"==a.Result?(psg.removeSessionItem("participantKey"),!app.isPhoneGap||psg.requiresEnrollmentConfirmation?$.mobile.changePage("enrollmentconfirmation.html"):psg.login($("#enrollment_email").val(),$("#password").val(),c)):WriteError(a.Result)}function c(a){$.mobile.changePage(null==a.Result||"success"==a.Result?"home.html":"login.html")}var d="ENROLLMENT > FIELD";"0"==psg.participantTypeId||psg.isOpenEnrollment||(d='ENROLLMENT > PARTICIPANT_TYPES[PARTICIPANT_TYPE_ID="'+psg.participantTypeId+'"] > FIELD');var e=ParseFields("enrollment",d),f=$("#enrollment_form_div");if(f.html(e.html),f.append(e.script),$("#page_enrollment_content").trigger("create"),!psg.isOpenEnrollment){var g=JSON.parse(sessionStorage.getItem(app.getBase()+"enrollPrefill"));PreFillForm(g[0],"enrollment")}$("#frmEnrollment").validate({submitHandler:a})}function ExpandAddressBlock(a){var b="";return b+='<label for="line_one">Address</label><input name="line_one" id="'+a+'_line_one" type="text" data-rule-required="true" data-msg-required="Address is required." >           <label for="line_one">Address 2</label><input name="line_two" id="'+a+'_line_two" type="text"  >           <label for="line_one">City</label><input name="city" id="'+a+'_city" type="text" data-rule-required="true" data-msg-required="City is required." >           <label for="line_one">State Code</label><input name="state" id="'+a+'_state" type="text" data-rule-required="true" data-msg-required="State Code is required." >           <label for="line_one">Zip Code</label><input name="zip" id="'+a+'_zip" type="text" data-rule-required="true" data-msg-required="Zip Code is required.">'}function page_enrollment_confirmation_show(){function a(a){psg.isNothing(a)||psg.isNothing(a.Content)?$("#psg-enrollment-confirmation-message").hide():($("#psg-enrollment-confirmation-message-title").html(a.Title),$("#psg-enrollment-confirmation-message-content").html(a.Content),$("#psg-enrollment-confirmation-message").show().collapsible("refresh"))}function b(b){null==b.Result||"success"==b.Result?(a(b),psg.setCache(e,b)):WriteError(b.Result)}function c(){psg.login($("#enrollment_email").val(),$("#password").val(),d)}function d(a){$.mobile.changePage(null==a.Result||"success"==a.Result?"home.html":"login.html")}app.isPhoneGap&&$("#psg-enrollment-confirmation-app-offer").hide(),$("#psg-enrollment-confirmation-continue-button").off("click",c).on("click",c),$("#psg-enrollment-confirmation-message").hide();var e="Enrollment Confirmation";if(psg.requiresEnrollmentConfirmation){var f=psg.getCache(e,24);if(f.expired){var g=!1;null!=f.data&&(g=!0),getJson("REMOTE.ENROLLMENT.CONFIRMATION.CONTENT",b)}else a(f.data)}}function page_home_show(){app.isPhoneGap||$("#home_settings").hide();var a=getHomeMenu(),b=$("#home_menu");b.html(a),b.listview("refresh")}function getHomeMenu(){if(null!=psg.homeMenu)return psg.homeMenu;var a={55:"pointshistory.html",57:"contact.html",89:"claimslanding.html",68:"profile.html",71:"shoppingmain.html",84:"quickpoints.html"},b=$(psg.configXml),c="MENU > SECTION";null!=psg.participantTypeId&&0!=psg.participantTypeId&&(c='MENU > PARTICIPANT_TYPES[PARTICIPANT_TYPE_ID="'+psg.participantTypeId+'"]');var d={whats_new:'<i class="fa fa-newspaper-o fa-lg fa-fw ui-menu-icon"></i>',55:'<i class="fa fa-history fa-lg fa-fw ui-menu-icon"></i>',57:'<i class="fa fa-envelope-o fa-lg fa-fw ui-menu-icon"></i>',89:'<i class="fa fa-clipboard fa-lg fa-fw ui-menu-icon"></i>',68:'<i class="fa fa-user fa-lg fa-fw ui-menu-icon"></i>',71:'<i class="fa fa-gift fa-lg fa-fw ui-menu-icon"></i>',84:'<i class="fa fa-certificate fa-lg fa-fw ui-menu-icon"></i>',points_awarded:'<i class="fa fa-trophy fa-lg fa-fw ui-menu-icon"></i>',orders:'<i class="fa fa-truck fa-lg fa-fw ui-menu-icon"></i>',claim_history:'<i class="fa fa-line-chart fa-lg fa-fw ui-menu-icon"></i>',wish_list:'<i class="fa fa-star-o fa-lg fa-fw ui-menu-icon"></i>',shopping_browse:'<i class="fa fa-th fa-lg fa-fw ui-menu-icon"></i>',shopping_cart:'<i class="fa fa-shopping-cart fa-lg fa-fw ui-menu-icon"></i>',shopping_search_filter:'<i class="fa fa-search-minus fa-lg fa-fw ui-menu-icon"></i>',rec_items:'<i class="fa fa-smile-o fa-lg fa-fw ui-menu-icon"></i>'},e={claim_history:"Performance Tracking",orders:"Orders",points_awarded:"Awards and Adjustments",rec_items:"Reward Yourself!",shopping_browse:"Browse Departments",shopping_cart:"Shopping Cart",shopping_search_filter:"Filter &amp; Sort",whats_new:"What's New",wish_list:"Wish List"};setHomeIcons(d);var f='<li><a href="whatsnew.html" data-transition="slide">'+psg.getMenuIcon("whats_new")+"&nbsp; What's New </a></li>",g=[{href:"home.html",text:"Home"},{href:"whatsnew.html",text:"What's New"}],h=!1;b.find(c).each(function(){var b=$(this),c=b.attr("TYPE_ID");if(89==c&&(h=!0),c in a){f+='<li><a href="'+a[c]+'" data-transition="slide">'+psg.getMenuIcon(c)+"&nbsp; "+b.attr("NAME")+"</a></li>",g[g.length]={href:a[c],text:b.attr("NAME")};var d="MENU";null!=psg.participantTypeId&&0!=psg.participantTypeId&&(d='MENU > PARTICIPANT_TYPES[PARTICIPANT_TYPE_ID="'+psg.participantTypeId+'"]'),d+=' > SECTION[TYPE_ID="'+c+'"]';var i=$(psg.configXml).find(d);e[c]=i.length>0?i.attr("NAME"):""}});var i='<li><a href="pointsawarded.html" data-transition="slide">'+psg.getMenuIcon("points_awarded")+'&nbsp; Awards and Adjustments </a></li> 							<li><a href="orders.html" data-transition="slide">'+psg.getMenuIcon("orders")+"&nbsp; Orders </a></li>";return h&&(i+='<li><a href="claimhistory.html" data-transition="slide">'+psg.getMenuIcon("claim_history")+"&nbsp; Performance Tracking</a></li>"),setHomePopupMenu(g),setHomeMenuString(f),setHomeHistoryMenu(i),setHomeMenuNames(e),psg.homeMenu}function setHomeIcons(a){psg.menuIcons=a}function setHomeMenuString(a){psg.homeMenu=a}function setHomeMenuNames(a){psg.menuNames=a}function setHomeHistoryMenu(a){psg.historyMenu=a}function setHomePopupMenu(a){addStandardMenuItems(a)}function page_ispu_select_show(){$("#ispu_select_item_title").text(sessionStorage.getItem(app.getBase()+"ispu.title"));var a=(sessionStorage.getItem(app.getBase()+"ispu.points"),sessionStorage.getItem(app.getBase()+"ispu.key")),b=JSON.stringify({key:a});getJson("ISPU.STORES.GET",HandleGetIpuSelect,b)}function HandleGetIpuSelect(a){if(null==a.Result||"success"==a.Result){var b="";$.each(a.Stores,function(a,c){b+='<li><h2><a target="_blank" href="'+c.StoreUrl+'">'+c.StoreName+"</a></h2>			<div>"+c.StoreAvailabilityMessage+"</div>","Not Available"!=c.StoreAvailabilityMessage&&(b+='<div class="ui-paragraph-padding psg-cg" data-role="controlgroup" data-type="horizontal" data-mini="true"> 								<button  data-psg-store-index="'+a+'" 								class="ispu-select-button ui-btn ui-btn-a ui-shadow ui-corner-all ui-first-child ui-last-child" >Select Store</button>'),b+="</li>"}),""==b&&(b="<li>No Stores Available</li>");var c=$("#page_ispu_select"),d=$("#ispu_select_listview");d.append(b),d.listview("refresh"),c.find(".psg-cg").controlgroup().controlgroup("refresh"),c.find(".ispu-select-button").on("click",function(b){var c=sessionStorage.getItem(getBase()+"ispu.key"),d=$(b.target).attr("data-psg-store-index"),e=a.Stores[d],f=JSON.stringify({key:c,Store:e});getJson("CHECKOUT.ISPU.STORES.SET",function(a){null==a.Result||"success"==a.Result?$.mobile.changePage("checkoutconfirm.html"):WriteError(a.Result)},f)})}else WriteError(a.Result)}function page_item_options_show(){$("#item_options_item_title").text(sessionStorage.getItem(getBase()+"add.title"));var a=$.parseXML(sessionStorage.getItem(getBase()+"add.options"));$xml=$(a),$label=$xml.find("OptionList > DropDownList").attr("Label"),id=$xml.find("OptionList > DropDownList").attr("ID");var b=sessionStorage.getItem(getBase()+"add.points"),c="",d=1,e=b.indexOf("From")>-1?!0:!1;$xml.find("OptionList > DropDownList > ListItem").each(function(){var a=$(this),b=a.attr("TotalPoints");c+='<input data-psg-id="'+id+'" name="order-choice" id="order-choice-'+d+'" 				value="'+a.attr("Value")+'"  type="radio"> 					<label for="order-choice-'+d+'">'+a.attr("Text"),e&&(c+=" / "+addCommas(b)+" Points"),c+="</label>",d++}),$("#item_options_points").text(b+" Points"),"Delivery Options"!=$label?($item_options=$("#item_options"),$("#item_options_legend").text($label+":"),$item_options.append(c),$item_options.show(),$item_options.controlgroup().controlgroup("refresh")):($delivery_options=$("#delivery_options"),$("#delivery_options_legend").text($label+":"),$delivery_options.append(c),$delivery_options.show(),$delivery_options.controlgroup().controlgroup("refresh"));var f=$("#page_item_options");f.find(":button").on("click",HandleItemOptionClick)}function HandleItemOptionClick(){var a="SHOPPING.WISHLIST.MOVETOCART",b=sessionStorage.getItem(getBase()+"add.key"),c=$("input[type=radio]:checked").attr("data-psg-id"),d=c+"="+$("input[type=radio]:checked").val()+";",e=JSON.stringify({key:b,options:d});getJson(a,HandleItemOptionCallback,e)}function HandleItemOptionCallback(a){null==a.Result||"success"==a.Result?$.mobile.pageContainer.pagecontainer("change","shoppingcart.html"):WriteError(a.Result)}function page_shopping_item_detail_show(){$("#psg_detail_onsale_info").hide(),$("#psg_ispu_info").hide(),itemDetails.show()}function page_login_show(){function a(){psg.login($("#login_email").val(),$("#login_password").val(),b)}function b(a){if("success"!=a.Result){{$("#login_error")}WriteError(null==a.Result?"General Error":a.Result)}else $.mobile.pageContainer.pagecontainer("change","home.html")}var c=app.getBase();if(app.isPhoneGap){var d=sessionStorage.getItem(c+"authFail");null!=d&&WriteError(d)}if(app.isPhoneGap&&$("#psg-login-desktop-link").hide(),app.offerMobileApp){$("#login_app_logo").attr("src","img/logo.png"),$("#login_app_name").text(app.appName),$("#login_app_company").text(app.appCompany);var e="",f=navigator.userAgent.toLowerCase(),g=/(ipad|iphone|ipod)/g.test(f),h=/android/g.test(f),i=/(iemobile|lumia)/g.test(f),j="";if(g||h||i){if(g){{f.indexOf("crios")>0}j=app.appUrlApple,e="FREE - On the App Store"}else h?(j=app.appUrlGoogle,e="FREE - On Google Play"):i&&(j=app.appUrlMicrosoft,e="FREE - On Windows Store");$("#launch_app_store_link").attr("href",j)}""===j&&$("#download_app_offer").hide(),$("#login_app_store").html(e)}else $("#download_app_offer").hide();psg.isOpenEnrollment===!0&&$("#login_enrollment_link").attr("href","enrollment.html");var k=localStorage.getItem(c+"last_email");"undefined"!=k&&null!=k&&""!=k&&$("#login_email").val(k),$("#frmLogin").validate({submitHandler:a})}function page_logout_show(){function a(){$.mobile.pageContainer.pagecontainer("change","login.html",{transition:"slide",reverse:!0})}getJson("LOGOUT",a)}function page_order_detail_show(){var a=sessionStorage.getItem("psg-order-id"),b=JSON.stringify({orderId:a});getJson("ORDER.ORDERDETAIL",HandleGetOrderDetail,b)}function HandleGetOrderDetail(a){if(null==a.Result||"success"==a.Result){if(null!=a.Order&&($("#psg-order-detail-order-number").text("Order "+a.Order.OrderNumber),$("#psg-order-detail-order-date").text("Date Ordered "+a.Order.DateOrdered)),null!=a.Address){var b="<strong>"+a.Order.ShipToName+"</strong><br/> "+psg.StringUtil.Concatenate("<br/>",a.Address.StreetAddress1,a.Address.StreetAddress2,psg.StringUtil.Concatenate(" ",psg.StringUtil.Concatenate(", ",a.Address.CityName,a.Address.StateCode),a.Address.PostalCode));$("#order_detail_shipping").html(b)}var c="",d=0,e="",f=0,g=new Object;if($.each(a.Order.OrderLineItemsMobile,function(a,b){var c=b.Shipment.ShipmentID,e=b.LineItemSequence,h="";if(9!=b.LineItemStatusId){if(null==g[c]){var i=!1;if(IsMinDate(b.Shipment.ShipmentDate)){var j=IsMinDate(b.Shipment.EstimatedShipDate)?"None":moment(b.Shipment.EstimatedShipDate,"YYYY-MM-DD").format("MM-DD-YYYY");h+='<li data-role="list-divider">Estimated Ship Date: '+j+"</li>"}else h+='<li data-role="list-divider">Shipped: '+moment(b.Shipment.ShipmentDate,"YYYY-MM-DD").format("MM-DD-YYYY")+"</li>",psg.isNothing(b.Shipment.CarrierName)||(h+='<li class="ui-text-small"><p>Shipped Via: '+b.Shipment.CarrierName,psg.isNothing(b.Shipment.TrackingNumber)||(h+=" Tracking : "+b.Shipment.TrackingNumber),!psg.isNothing(b.Shipment.TrackingURL)&&b.Shipment.TrackingURL.indexOf("http")>-1&&(h+=' <a class="ui-tracking-number" target="_blank" rel="external" title="Click to open shipment tracking" href="'+b.Shipment.TrackingURL+'">Track Package</a>'),h+="</p></li>"),i=!0;var k=new Object,l=new Object;k.ShipmentInfo=h,k.Shipped=i,k.Rows=l,g[c]=k}g[c].Rows[e]=GetTableRow(b),g[c].Shipped?d++:f++}}),$.each(g,function(a,b){b.Shipped?c+=b.ShipmentInfo+'<li class="ui-text-small">'+GetTable(b.Rows,a)+"</li>":e+=b.ShipmentInfo+'<li class="ui-text-small">'+GetTable(b.Rows,a)+"</li>"}),psg.isNothing(a.Transactions)||a.Transactions.length<2)$("#order_detail_trans_container").hide();else{$("#order_detail_transaction_count").text(a.Transactions.length);var h='<table class="ui-text-small ui-responsive ui-table ui-table-columntoggle" data-role="table" data-mode="columntoggle"><thead><tr><th>Date</th> 							  <th>Description</th><th>Amount</th></tr></thead><tbody>';$.each(a.Transactions,function(a,b){h+='<tr> 						<td width="30%" class="ui-text-right">'+moment(b.TransactionDate,"YYYY-MM-DD").format("MM-DD-YYYY")+'</td> 						<td style="white-space:normal;">'+b.TransactionDescription+'</td> 						<td class="ui-text-right ptsRght">'+addCommas(b.RedeemedPoints)+"</td> 					</tr>"}),h+="</tbody></table>",$("#order_detail_trans").html(h)}""==c&&(c="<li>No Items Shipped</li>"),""==e&&(e="<li>All Items Shipped</li>");var i=$("#psg-listview-orderitems-shipped");i.html(c),$("#order_detail_shipped_count").text(d),i.listview("refresh");var j=$("#psg-listview-orderitems-not-shipped");j.html(e),$("#order_detail_not_shipped_count").text(f),j.listview("refresh"),0==d?$("#order_detail_item_shipped_col").hide():d>0&&0==f&&$("#order_detail_item_shipped_col").collapsible("expand"),0==f?$("#order_detail_item_not_shipped_col").hide():f>0&&0==d&&$("#order_detail_item_not_shipped_col").collapsible("expand"),app.isPhoneGap&&$("#psg-listview-orderitems-shipped").on("click","a",function(a){a.preventDefault(),window.open($(this).attr("href"),"_system")
})}else WriteError(a.Result)}function GetTableRow(a){var b='<tr> 						<td class="ui-text-right">'+a.Quantity+'</td> 						<td style="white-space:normal;">'+a.ItemDescription+'</td> 						<td class="ui-text-right ptsRght">'+addCommas(a.ExtendedPoints)+"</td> 					</tr>";return b}function GetTable(a,b){var c='<table id="table_'+b+'" class="ui-responsive ui-table ui-table-columntoggle" data-role="table" data-mode="columntoggle" > 				<thead><tr> 					<th>Qty</th> 					<th>Item</th> 					<th>Total</th> 				</tr></thead> 				<tbody>';return $.each(a,function(a,b){c+=b}),c+="</tbody> 			</table>"}function page_orders_show(){getJson("ORDER.ORDERS",function(a){var b="";$.each(a,function(a,c){b+='<li data-psg-divider="'+moment(c.DateOrdered,"MM-DD-YYYY").format("MMMM YYYY")+'"> 				<a href="#" data-psg-order-id="'+c.OrderID+'" class="link-order"> 					<div class="ui-no-ellipse ui-text-small"><strong>Order '+c.OrderNumber+'</strong></div> 					<div class="ui-text-small"> 					<div class="ui-float-left">'+c.DateOrdered+'</div> 					<div class="ui-float-right">'+addCommas(c.TotalPoints)+" points</div> 				</div> 				</a> 				</li>"});var c=$("#psg-listview-orders");c.html(b),c.listview({autodividers:!0,dividerTheme:"a",autodividersSelector:function(a){var b=a.attr("data-psg-divider");return b}}),c.listview("refresh"),$(".link-order").on("click",function(){sessionStorage.setItem("psg-order-id",$(this).attr("data-psg-order-id")),$.mobile.changePage("orderdetail.html")})})}function page_password_reset_show(){$("#frmReset").validate({submitHandler:submitResetForm})}function submitResetForm(){var a=psg.programGuid,b=JSON.stringify({program_guid:a,email:$("#reset_email").val(),security_code:$("#reset_security_code").val()});getJson("ENROLLMENT.PASSWORD.RESET",ResetCallback,b)}function ResetCallback(a){"success"==a.Result?(WriteError("If you provided a registered email address, then instructions to reset your password have been sent. Please check your email."),$("#do_reset").hide(),$("#reset_close").show()):WriteError(a.Result)}function page_points_awarded_show(){getJson("PARTICIPANT.GETAWARDPOINTS",HandleGetPointsAwarded)}function HandleGetPointsAwarded(a){var b="";$.each(a,function(a,c){b+='<li data-psg-divider="'+moment(c.TransactionDate,"YYY-MM-DD").format("MMMM YYYY")+'"><div class="ui-no-ellipse ui-text-small"><strong>'+c.TransactionDescription+'</strong></div><div class="ui-grid-a"> <div class="ui-block-a ui-text-small">'+moment(c.TransactionDate,"YYYY-MM-DD").format("MM-DD-YYYY")+'</div><div class="ui-block-b ui-text-small ui-text-right">'+addCommas(c.Amount)+"</div> </div></li>"});var c=$("#psg-listview-pointsawarded");c.html(b),c.listview({autodividers:!0,dividerTheme:"a",autodividersSelector:function(a){var b=a.attr("data-psg-divider");return b}}),c.listview("refresh")}function page_points_history_show(){var a=null==psg.getSessionItem("awarded")?"Unknown":psg.getSessionItem("awarded"),b=null==psg.getSessionItem("redeemed")?"Unknown":psg.getSessionItem("redeemed"),c=null==psg.getSessionItem("balance")?"Unknown":psg.getSessionItem("balance");$("#ph_awarded").text(a),$("#ph_redeemed").text(b),$("#ph_remaining").text(c);var d=psg.historyMenu,e=$("#points_history_menu_ul");e.html(d),e.listview("refresh")}function page_promotion_detail_show(){function a(a){var b="",c=psgClaimHistory.Data.get();$.each(c.Promotions,function(c,d){psg.isNothing(d)||d.promotion_id!=a||(b+='<h3 class="headerDivider">'+d.promotion_name+"</h3><div>",b+=moment(d.sales_start_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+=" thru ",b+=moment(d.sales_end_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+="</div><div>",b+=psg.NumberUtil.toPoints(d.payout),b+='</div><div id="psg-collapsible-set-promotion-detail" data-role="collapsibleset" data-theme="a" data-content-theme="a" data-inset="false">')});var d=0,e="",f=parseInt(a);$.each(c.Goals,function(a,b){if(!psg.isNothing(b)&&b.promotion_id==f&&!psg.isNothing(b.goal_value)&&0!=b.goal_value){switch(d++,e+='<li><table width="100%"><tr><td>',b.goal_basis){case 0:case 1:e+=psg.StringUtil.Concatenate(" ",b.product_code,b.tier_group_name,"Units Goal").trim();break;case 2:e+=psg.StringUtil.Concatenate(" ",b.product_code,b.tier_group_name,"Sales Goal").trim()}switch(e+='</td><td class="ui-text-right"><strong>',b.goal_basis){case 0:case 1:e+=psg.NumberUtil.toNumber(b.goal_value,2)+" Units";break;case 2:e+=psg.NumberUtil.toCurrency(b.goal_value)}e+='</strong></td></tr></table><table width="100%"><tr><td><div class="psg-promotion-goal-progress-bar" psg-progress-percent="',e+=psg.NumberUtil.toNumber(b.tier_size<=0?100:b.tier_progress<=0?0:b.tier_progress>=b.tier_size?100:b.tier_progress/b.tier_size*100,0),e+='"></div></td><td class="ui-text-right"><small>';var c;switch(b.goal_basis){case 0:case 1:c=b.units_sold,c>b.goal_value&&(c=b.goal_value),b.tier_progress>0&&(e+=psg.NumberUtil.toNumber(c,2)+" Units");break;case 2:c=b.total_sales,c>b.goal_value&&(c=b.goal_value),b.tier_progress>0&&(e+=psg.NumberUtil.toCurrency(c))}e+="</small></td></tr></table></li>"}}),d>0&&(b+='<div data-role="collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-theme="a" data-content-theme="a"><h3><div class="ui-btn-up-c ui-btn-corner-all ui-li-count">',b+=psg.NumberUtil.toNumber(d,0),b+='</div>Goals</h3><ul id="psg-listview-promotiongoals" data-role="listview" data-theme="a" data-divider-theme="a">',b+=e,b+="</ul></div>"),b+='<div id="psg-collapsible-promotion-claims" data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-collapsed="false" data-theme="a" data-content-theme="a"><h3><div class="ui-btn-up-c ui-btn-corner-all ui-li-count">';var g=[],h=psgClaimHistory.Filter.get();return $.each(c.Claims,function(b,c){if(!psg.isNothing(c)&&c.promotion_id==a){switch(h.ClaimFilter){case"2":if("0"!=c.status_type_id)return;break;case"3":if("1"!=c.status_type_id&&"2"!=c.status_type_id)return;break;case"4":if("3"!=c.status_type_id)return;break;case"5":if("4"!=c.status_type_id)return}g[g.length]=c}}),b+=psg.NumberUtil.toNumber(g.length,0),b+='</div>Claims</h3><ul id="psg-listview-promotionclaims" data-role="listview" data-theme="a" data-divider-theme="a"><li><div id="psg-promotion-claim-view-cGroup" data-role="controlgroup"><label for="psg-promotion-claim-view">View</label><select name="psg--claim-view" id="psg-promotion-claim-view" data-mini="true" data-inline="true" data-native-menu="true"><option>Filter your claims</option>',$.each(c.Views,function(a,c){psg.isNothing(c)||(b+='<option value="'+c.Key+'"'+(c.Key==h.ClaimFilter?" selected":"")+">"+c.Value+"</option>")}),b+="</select></div></li>",b+=0==g.length?'<li><p class="ui-no-ellipse">You have no matching claims, or your claims are archived.</p></li>':psgClaimHistory.buildClaimList(g),b+="</ul></div></div>"}var b=$("#psg-promotion-detail-content");b.html("");var c=psgClaimHistory.SelectedPromotion.get();if(psg.isNothing(c))return void b.html('<p class="error"><strong>Yikes!</strong> Unable to retrieve the promotion ID.</p><p class="ui-text-small">Try returning to the main menu and see if the problem corrects itself.</p>');var d=a(c);b.html(d);var e=b.children("#psg-collapsible-set-promotion-detail");e.collapsibleset().collapsibleset("refresh"),e.find(":jqmData(role=listview)").listview().listview("refresh"),e.find(":jqmData(role=controlgroup)").controlgroup().controlgroup("refresh"),e.find(".psg-promotion-goal-progress-bar").each(function(){var a=$(this),b=parseFloat(a.attr("psg-progress-percent"));a.jqxProgressBar({width:180,height:23,value:b,showText:!0})}),e.find(".jqx-widget-content").css("background-color","#999"),e.find(".jqx-widget-content").css("color","white"),e.find(".jqx-fill-state-pressed").css("background-color","green"),$("#psg-promotion-claim-view").on("change",function(){var a=psgClaimHistory.Filter.get();a.ClaimFilter=$(this).val(),psgClaimHistory.Filter.set(a),page_promotion_detail_show()}),e.find(".psg-claim-item").on("click",function(a){var b=$(a.delegateTarget).attr("psg-claim-id");psgClaimHistory.SelectedClaim.set(b)})}function page_promotion_history_show(){function a(a){var b=psgClaimHistory.Filter.get(),c="";return c+='<li data-theme="c" class="ui-text-small"><table><tr><td>Promotions</td><td><fieldset data-role="controlgroup" data-type="horizontal" data-mini="true"><input name="psg_promotion_filter" id="psg_promotion_filter_active" class="psg_promotion_filter" value="0" type="radio"',c+="0"==b.PromotionFilter?' checked="true"':"",c+='><label for="psg_promotion_filter_active">Active</label><input name="psg_promotion_filter" id="psg_promotion_filter_all" class="psg_promotion_filter" value="1" type="radio"',c+="1"==b.PromotionFilter?' checked="true"':"",c+='><label for="psg_promotion_filter_all">All</label></fieldset></td></tr></table></li>',psg.isNothing(a)?c+="<li><p>There are no matching or eligible promotions.<p></li>":$.each(a,function(a,b){c+='<li><a href="promotiondetail.html" class="psg-promotion-item" data-transition="slide" psg-promotion-id="',c+=b.promotion_id.toString(),c+='"><div class="ui-no-ellipse ui-text-small"><strong>',c+=b.promotion_name,c+='</strong></div><div class="ui-text-small"><div class="ui-float-left">',c+=moment(b.sales_start_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),c+=" thru ",c+=moment(b.sales_end_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),c+='</div><div class="ui-float-right">',c+=psg.NumberUtil.toPoints(b.payout),c+="</div></div></a></li>"}),c}var b=psgClaimHistory.Filter.get(),c=psgClaimHistory.Data.get(),d=a(c.Promotions),e=$("#psg-listview-promotionhistory");e.html(d).listview().listview("refresh"),e.find(":jqmData(role=controlgroup)").controlgroup().controlgroup("refresh"),e.find('.psg_promotion_filter [value="'+b.PromotionFilter+'"]').prop("checked",!0),e.find(".psg_promotion_filter").on("click",function(a){var b=psgClaimHistory.Filter.get();b.PromotionFilter=$(a.delegateTarget).val(),psgClaimHistory.Filter.set(b),getJson("CLAIM.HISTORY.GET",function(a){a=psgClaimHistory.Data.prep(a),psgClaimHistory.Data.set(a),page_claim_detail_show()},b)}),e.find(".psg-promotion-item").on("click",function(a){var b=$(a.delegateTarget).attr("psg-promotion-id");psgClaimHistory.SelectedPromotion.set(b)})}function page_promotion_info_show(){function a(a){var b="";return psg.isNothing(a)?b+='<p class="error"><strong>Yikes!</strong> Unable to retrieve the promotion.</p><p class="ui-text-small">Try returning to the main menu and see if the problem corrects itself.</p>':(b+='<h3 class="headerDivider">'+a.promotion_name+'</h3><div class="ui-field-contain"><label for="psg-promotion-sales-dates">Eligible Sales:</label><span name="psg-promotion-sales-dates">',b+=moment(a.sales_start_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+=" thru ",b+=moment(a.sales_end_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+='</span></div><div class="ui-field-contain"><label for="psg-promotion-sales-dates">Must submit by:</label><span name="psg-promotion-sales-dates">',b+=moment(a.disable_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+='</span><div><h4>Applicable Products</h4><button id="psg-promotion-info-download-products" class="ui-btn ui-btn-a ui-mini ui-icon-action ui-btn-icon-left">Show Eligible Products</button><div id="psg-promotion-info-products"></div>'),b}var b=$("#psg-promotion-info-content");b.html("");var c=psg.getSessionItem("promotion_id");if(psg.isNothing(c))return void b.html('<p class="error"><strong>Yikes!</strong> Unable to retrieve the promotion ID.</p><p class="ui-text-small">Try returning to the main menu and see if the problem corrects itself.</p>');var d=null;$.each(JSON.parse(psg.getSessionItem("claim.promotions")),function(a,b){psg.isNothing(b)||b.promotion_id!=c||(d=b)});var e=a(d);b.html(e),b.find(":jqmData(role=controlgroup)").controlgroup().controlgroup("refresh"),b.find("#psg-promotion-info-download-products").on("click",function(){getJson("CLAIM.PROMOTION.PRODUCTS.GET",function(a){var c="";if(psg.isNothing(a)||psg.isNothing(a.Products))c+='<p class="ui-no-ellipse">There are no eligible products, currently.</p>';else{c+='<table class="ui-text-small" data-role="table" data-mode="columntoggle"><thead><tr><th>Code</th><th>Name</th></tr></thead><tbody>';var d=[];$.each(a.Products,function(a,b){psg.isNothing(b)||d.indexOf(b.product_code)>-1||(d[d.length]=b.product_code,c+="<tr><td>",c+=b.product_code.toUpperCase(),c+="</td><td>",c+=b.product_name,c+="</td></tr>")}),c+="</tbody></table>"}b.find("#psg-promotion-info-download-products").hide();var e=b.find("#psg-promotion-info-products");e.html(c),e.find(":jqmData(role=table)").table().table("refresh")},{PromotionId:c})})}function page_invitation_show(){function a(a){13==a.which&&(a.preventDefault(),b())}function b(){if(""==$("#invitation_id").val().trim())return void WriteError("You must enter a value");var a=JSON.stringify({invitation_id:$("#invitation_id").val(),program_guid:psg.programGuid});getJson("ENROLLMENT.INVITATION",c,a)}function c(a){if("success"==a.Result)psg.participantTypeId=a.ParticipantDataTable[0].participant_type_id,psg.setSessionItem("enrollPrefill",JSON.stringify(a.ParticipantDataTable)),psg.setSessionItem("participantKey",a.ParticipantKey),$.mobile.pageContainer.pagecontainer("change","enrollment.html");else{var b=a.Result;b.indexOf("login")>1&&(b=b.replace("login",'login <a href="login.html">here</a>')),WriteError(b)}}function d(){cordova.plugins.barcodeScanner.scan(function(a){a.cancelled||($("#invitation_id").val(a.text),b())},function(){navigator.notification.alert("Unable to read QR code.",function(){},"Scan Failed","OK")})}var e="Invitation ID",f=$(psg.configXml).find("ENROLLMENT").attr("INVITATION_LABEL");f&&(e=f),$("#invitation_label").text(e);var g=$(psg.configXml).find('ENROLLMENT[ENABLE_INVITATION_SCAN="1"]').length>0;if(g&&app.isPhoneGap){$("#invitation_scan_inscrutions").show();var h=$("#icon_invitation_scan");h.show(),h.off("click",d).on("click",d),$("#icon_invitation_scan2").off("click",d).on("click",d),$("#invitation_id").focus(function(){$("#qpointsContainer .panelRight").hide(),$(".focusScan").show()}),$("#invitation_id").blur(function(){$("#qpointsContainer .panelRight").show()}),$("#invitation_id").keyup(function(){$(this).val().length>0?$(".focusScan").hide():$(".focusScan").show()})}$("#invitation_id").off("keypress",a).on("keypress",a),$("#invitation_submit").off("click",b).on("click",b)}function page_quick_points_show(){app.isPhoneGap&&$("#quick_points_scan_instructions").show(),$("#quick_points_submit").click(function(){if(""==$("#certificate_number").val().trim())return void WriteError("You must enter a value");$(this).prop("disabled",!0);var a=JSON.stringify({certificate_number:$("#certificate_number").val()});getJson("QUICKPOINTS.SAVE",HandleQuickPointsCallback,a,function(){$("#quick_points_submit").prop("disabled",!1)})}),$("#certificate_number").keypress(function(a){13==a.which&&$("#quick_points_submit").trigger("click")}),app.isPhoneGap&&($("#quick_points_scan").show().click(HandleQuickPointsScan),$("#quick_points_scan2").click(HandleQuickPointsScan),$("#certificate_number").focus(function(){$("#qpointsContainer .panelRight").hide(),$(".focusScan").show()}),$("#certificate_number").blur(function(){$("#qpointsContainer .panelRight").show(function(){0==$("#certificate_number").val().length&&$(".focusScan").hide()})}),$("#certificate_number").keyup(function(){$(this).val().length>0?$(".focusScan").hide():$(".focusScan").show()}))}function HandleQuickPointsScan(){cordova.plugins.barcodeScanner.scan(function(a){$("#certificate_number").val(a.text),$("#quick_points_submit").trigger("click")},function(){navigator.notification.alert("Unable to read QR code",function(){},"Scan Failed","OK")})}function HandleQuickPointsCallback(a){$("#quick_points_submit").prop("disabled",!1),null==a.Result||"success"==a.Result?(null!==typeof a.PointAccount&&UpdatePointAccount(a.PointAccount),$("#certificate_number").val(""),ShowAlert("We have added "+a.Amount+" points to your account.","Congratulations!"),WriteError(""),psg.pageInit()):WriteError(a.Result)}function page_receipt_show(){$("#receipt_order_number").text(sessionStorage.getItem(getBase()+"checkout.orderNumber"));var a=sessionStorage.getItem(getBase()+"checkout.hasISPU");"true"==a&&$("#receipt_ispu").show(),sessionStorage.removeItem(getBase()+"checkout.hasISPU"),sessionStorage.removeItem(getBase()+"checkout.orderNumber"),getJson("POINTS.SUMMARY",null,HandleGetReceipt)}function HandleGetReceipt(a){null!==typeof a&&UpdatePointAccount(a)}function page_remote_content_show(){var a=psg.getSessionItem("remote_section_name"),b=psg.getCache(a,24);if(b.expired){var c=!1;null!=b.data&&(c=!0);var d=JSON.stringify({SectionName:a});getJson("REMOTE.CONTENT",HandleRemoteContentCallback,d)}else LoadRemoteContent(b.data)}function HandleRemoteContentCallback(a){if(null==a.Result||"success"==a.Result){LoadRemoteContent(a);var b=psg.getSessionItem("remote_section_name");psg.setCache(b,a)}else WriteError(a.Result)}function LoadRemoteContent(a){$("#remote_content_title").text(a.Title),$("#remote_content_div").html(a.Content),$("#remote_content_main").trigger("create")}function page_shopping_cart_show(a){function b(a){var b="",d=0,e=0,f=!1;$.each(a,function(a,c){e+=c.ExtendedPoints,d=c.PointBalance,null!=c.SelectedOrderOptions&&c.SelectedOrderOptions.indexOf("DELIVERYMETHOD=ISPU")>-1&&(f=!0),b+='<li><img class="ui-product-thumbnail ui-margin-top-1x" src="'+c.ItemSmallImageUrlFullyQualified+'"/>							<h2 class="ui-no-ellipse shopDscptStyle">'+c.ItemName+"</h2>							<div>"+c.SelectedOrderOptionsFormatted+'</div><p><a href="#" data-psg-item-key="'+htmlEncode(JSON.stringify(c.CatalogItemKey))+'" data-transition="slide" class="link-detail">Details</a></p>							<p class="ui-paragraph-padding"><span class="shopPtsStyle">'+c.ExtendedPointsFormatted+' </span>points</p> 							<div class="ui-text-small">Quantity: '+c.Quantity+'&nbsp &nbsp								<button data-psg-key="'+c.LineItemSequence+'" data-mini="true" class="shopping-cart-add ui-btn ui-btn-a ui-icon-plus ui-btn-icon-notext ui-shadow ui-corner-all ui-btn-inline">Add</button> &nbsp &nbsp 								<button data-psg-key="'+c.LineItemSequence+'" data-mini="true" class="shopping-cart-subtract ui-btn ui-btn-a ui-icon-minus ui-btn-icon-notext ui-shadow ui-corner-all ui-btn-inline">Subtract</button> 							</div> 							<div class="psg-cg"> 								<button data-psg-key="'+c.LineItemSequence+'" data-mini="true" class="shopping-cart-remove noCenter ui-btn ui-btn-a ui-shadow ui-corner-all ">Remove</button> 								<button data-psg-key="'+c.LineItemSequence+'" data-mini="true" class="shopping-cart-to-wishlist noCenter ui-btn ui-btn-a ui-shadow ui-corner-all" >Move to Wish List</button> 							</div> 						</li>'}),sessionStorage.setItem(getBase()+"checkout.hasISPU",f),""==b&&(b="<li>No items in your shopping cart.</li>",$("#psg_shopping_cart_checkout_button").hide());var g=$("#page_shopping_cart"),h=$("#psg-listview-shopping_cart");h.html(b);var i=d-e;h.listview("refresh"),$("#psg_shopping_cart_total_points").html(addCommas(e)),$("#psg_shopping_cart_remaining_points").html(addCommas(i)),g.find(".psg-cg").controlgroup().controlgroup("refresh"),g.find(".shopping-cart-add").on("click",function(a){c(a,"SHOPPING.CART.INCREMENT")}),g.find(".shopping-cart-subtract").on("click",function(a){c(a,"SHOPPING.CART.SUBTRACT")}),g.find(".shopping-cart-remove").on("click",function(a){c(a,"SHOPPING.CART.REMOVE")}),g.find(".shopping-cart-to-wishlist").on("click",function(a){c(a,"SHOPPING.CART.MOVETOWISHLIST")}),g.find(".link-detail").on("click",function(){psg.setSessionItem("psg-item-key",$(this).attr("data-psg-item-key")),$.mobile.pageContainer.pagecontainer("change","itemdetail.html",{transition:"slide"})})}function c(a,c){var d=$(a.target).attr("data-psg-key"),e=JSON.stringify({key:d});getJson(c,function(){getJson("SHOPPING.SHOPPINGCARTITEMS",b)},e)}function d(){return $("#shopping_cart_remaining").attr("data-psg-remaining")<0?void WriteError("You have insufficient points in your account to redeem the items in the shopping cart."):void getJson("CHECKOUT.CART.REFRESH",e)}function e(a){a.SSNRequired||a.BuyInRequired?(WriteError("You must checkout using the desktop site.  Click <a rel='external' class='cart_desktop_link' data-role='none' data-enhance='false' href='../cart.aspx'>HERE</a> to complete."),app.isPhoneGap&&$(".cart_desktop_link").click(function(){return window.open(psg.baseUrl+"/Cart.aspx","_system"),!1})):null==a.Result||"success"==a.Result?$.mobile.pageContainer.pagecontainer("change","checkoutaddress.html"):WriteError(a.Result)}$("#psg_shopping_cart_checkout_button").on("click",d),"page_shopping_main"==a?(cache=psg.getCache("shoppingCart",.25),null===cache.data||cache.expired?getJson("SHOPPING.SHOPPINGCARTITEMS",b):b(cache.data)):getJson("SHOPPING.SHOPPINGCARTITEMS",b);var f=psg.getSessionItem("cartChangeDetails");f&&(WriteError(f),psg.removeSessionItem("cartChangeDetails"))}function page_shopping_recomended_show(){function a(a){if("success"==a.Result){var b='<span id="reward_yourself"></span>';0===a.RecommendedItems.length?b="No items to recommend for your point balance.":$.each(a.RecommendedItems,function(a,c){b=GetCatalogItemListItem(c,b)});var c=$("#psg-listview-recommend");c.html(b),c.listview("refresh"),c.find(".link-detail").on("click",function(){sessionStorage.setItem(getBase()+"psg-item-key",$(this).attr("data-psg-item-key")),$.mobile.changePage("itemdetail.html")})}else WriteError(a.Result)}$("#reward_yourself").length||getJson("SHOPPING.RECOMMENDED",a)}function page_shopping_browse_show(){function a(a){null==a.Result||"success"==a.Result?(psgShopping.Departments.set(a.TopCategories),b()):WriteError(a.Result)}function b(){var a=psgShopping.Departments.get(),b="";$.each(a,function(a,c){b+='<li >	<a href="#" class="psg_shopping_browse_dept_filter" 				psg-filter-value="'+c.Code+'"> '+c.Name+"	</a> </li> "}),$("#psg_shopping_browse_filter_items").html(b),$("#psg_shopping_browse_filter_items").listview("refresh"),$(".psg_shopping_browse_dept_filter").click(function(){var b=$(this).attr("psg-filter-value"),c=$.grep(a,function(a){return a.Code==b});psg.isNothing(c)||(psg.setSessionItem("shoppingSearchInit","true"),psgShopping.Search.Mode.reset(),psgShopping.Department.Current.reset(),psgShopping.Department.Current.set(c[0]),psgShopping.Search.Term.set(null),psgShopping.Search.Trigger.set(),$.mobile.pageContainer.pagecontainer("change","shoppingsearch.html"))})}psg.isNothing(psg.getSessionItem("shopping.departments"))?getJson("SHOPPING.DEPARTMENTS",a):b()}function page_shopping_main_show(){psgShopping.Search.Mode.set(),psgShopping.Search.Trigger.reset(),psgShopping.Department.Current.reset(),$("#shoppingmain_point_balance").html(psg.getSessionItem("balance")),$("#shoppingmain_wish_count").hide(),getJson("SHOPPING.WISHLISTITEMS",function(a){a.length>0?($("#shoppingmain_wish_count").show(),$("#shoppingmain_wish_count").html(a.length),psg.setCache("wishList",a)):psg.removeCache("wishList")},null,function(){},1e4,!0,!1),$("#shoppingmain_cart_count").hide(),getJson("SHOPPING.SHOPPINGCARTITEMS",function(a){a.length>0?($("#shoppingmain_cart_count").show(),$("#shoppingmain_cart_count").html(a.length),psg.setCache("shoppingCart",a)):psg.removeCache("shoppingCart")},null,function(){},1e4,!0,!1)}function page_shopping_search_show(){function a(a){13==a.which&&(a.preventDefault(),psgShopping.Search.go())}var b=psgShopping.Search.Term.get();psg.isNothing(b)&&$("#psg_search_keyword").val("");var c=psgShopping.Department.Current.get();$("#shoppingsearch_search_department").html("Search "+(psg.isNothing(c)?"Catalog":c.Name)),psg.isNothing(c)||""==c.Code?$("#shoppingsearch_browse_department").hide():($("#shoppingsearch_browse_department").show(),$("#shoppingsearch_browse_department").html("<strong>Items from: "+c.Name+"</strong>")),psgShopping.Search.Trigger.isSet()&&(psgShopping.Search.Trigger.reset(),psgShopping.Search.go()),app.isPhoneGap&&($("#icon_search_scan").show(),$("#icon_search_scan2").off("click").click(shoppingSearchScan),$("#psg_search_keyword").focus(function(){$("#qpointsContainer .panelRight").hide(),$(".focusScan").show()}),$("#psg_search_keyword").blur(function(){$("#qpointsContainer .panelRight").show(function(){0==$("#psg_search_keyword").val().length&&$(".focusScan").hide()})}),$("#psg_search_keyword").keyup(function(){$(this).val().length>0&&$(".focusScan").hide()})),$("#psg_search_keyword").off("keypress").on("keypress",a),$("#icon_search_scan").off("click").click(shoppingSearchScan)}function shoppingSearchScan(){clickedSearchScan=!1,cordova.plugins.barcodeScanner.scan(function(a){a.cancelled||($("#psg_search_keyword").val(a.text),psgShopping.Search.go()),$("#btn_search_scan").hide()},function(){navigator.notification.alert("Unable to read bar code.",function(){},"Scan Failed","OK"),$("#btn_search_scan").hide()})}function HandleGetSearch(a){if($("#psg_search_keyword").removeAttr("placeholder"),null==a.Result||"success"==a.Result){var b=(psgShopping.Department.Current.get(),$("#psg_search_keyword").val(),psgShopping.Search.Mode.isSet()),c=20*a.ItemsCollection.PageIndex+1,d=a.ItemsCollection.CatalogItems.length+c-1,e="<li data-theme='a'>	<table cellspacing='0' width='100%'>		<tr>			<td><strong>"+(b?a.ItemsCollection.TotalItemCount+" Items</strong> ("+c+" to "+d+")":"Items</strong>")+"			</td>			<td style='text-align:right;'>				<a href='shoppingsearchfilter.html' class='linkBtn ui-btn ui-btn-a ui-shadow ui-corner-all ui-mini' data-transition='slidedown' data-rel='dialog'>Filter &amp; Sort</a>			</td>		</tr>	</table></li>";0==a.ItemsCollection.TotalItemCount?e+='<li><i class="fa fa-lg fa-frown-o fa-fw"></i>&nbsp;No items are available.</li>':$.each(a.ItemsCollection.CatalogItems,function(a,b){e=GetCatalogItemListItem(b,e)});var f=0,g="";a.ItemsCollection.PageIndex>0&&(g+="<button data-mini='true' id='psg_shopping_search_less_button' data-theme='a' class='noCenter ui-btn ui-btn-a ui-corner-all ui-icon-carat-l ui-btn-icon-left'>Back</button>",++f),g+="</td><td align='center'>",a.ItemsCollection.PageIndex+1<a.ItemsCollection.PageCount&&(g+="<button data-mini='true' id='psg_shopping_search_more_button' data-theme='a' class='noCenter ui-btn ui-btn-a ui-corner-all ui-icon-carat-r ui-btn-icon-right'>More</button>",++f),f>0&&(e+="<li data-theme='a'><table width='100%'><col width='50%'><col width='50%'><tr><td align='center'>"+g+"</td></tr></table></li>");var h=$("#psg_listview_search");psgShopping.Search.DepartmentCounts.set(a.ItemsCollection.DepartmentCounts),psgShopping.Search.PageIndex.set(a.ItemsCollection.PageIndex),h.html(e),h.listview("refresh"),h.find(".link-detail").on("click",function(){psg.setSessionItem("psg-item-key",$(this).attr("data-psg-item-key")),$.mobile.pageContainer.pagecontainer("change","itemdetail.html",{transition:"slide"})}),$("#psg_shopping_search_more_button").on("click",function(){shoppingSearchGetMore(1)}),$("#psg_shopping_search_less_button").on("click",function(){shoppingSearchGetMore(-1)}),WriteError(a.Result)}}function shoppingSearchGetMore(a){$("#psg_listview_search").html("");var b="yes"==psg.getSessionItem("shoppingSearchLimit")?psg.getSessionItem("balance_number"):0;null==b&&(b=0);var c=psgShopping.Department.Current.get(),d=JSON.stringify({categoryCode:psg.isNothing(c)?"":c.Code,keywords:psgShopping.Search.Term.get(),pageIndex:Number(psgShopping.Search.PageIndex.get())+a,sort:Number(psgShopping.Department.SortOrder.get()),minPoints:0,maxPoints:Number(b)});getJson("SHOPPING.SEARCH",HandleGetSearch,d,null,2e4)}function page_shopping_search_filter_show(){var a=psgShopping.Department.Parent.get(),b=psgShopping.Department.Current.get();psg.isNothing(b)&&(b={Code:"",Name:"Catalog"}),!psg.isNothing(b)&&psg.isNothing(a)&&psgShopping.Search.Mode.isSet()&&""!=b.Code&&(a={Code:"",Name:"Catalog"});var c='<li data-role="list-divider" data-theme="a" data-inset="false">Narrow by Department</li>',d=["","ui-indent-1x","ui-indent-2x"],e=0;psg.isNothing(a)||(c+='<li data-icon="arrow-u"><a href="#" class="psg_shopping_search_dept_filter" psg-filter-value="'+a.Code+'"><span class="dept_catalog_category_name">'+a.Name+"</span></a></li>",e++),c+='<li><span class="dept_catalog_category_name ',c+=d[e],c+='">',c+=b.Name,c+="</span></a></li>",e++;var f=d[e],g=psgShopping.Search.Mode.isSet(),h=psgShopping.Search.DepartmentCounts.get();for(var i in h){var j=h[i];c+='<li class="ui-depart-indent"><a href="#" class="psg_shopping_search_dept_filter" psg-filter-value="'+j.CatalogCategoryCode+'"><span class="dept_catalog_category_name '+f+'">'+j.CatalogCategoryName+"</span>",g&&(c+='<span class="ui-li-count">'+j.ItemCountString+"</span>"),c+="</a></li>"}$("#search_filter_departments_container").show(),$("#search_filter_departments").html(c),$("#search_filter_departments").listview("refresh"),$(".psg_shopping_search_dept_filter").on("click",function(){var a=$(this),b=a.attr("psg-filter-value"),c=a.find(".dept_catalog_category_name").html();psgShopping.Department.Current.set({Code:b,Name:c}),psgShopping.Search.Trigger.set(),$("#page_shopping_search_filter").dialog("close")});var k=psgShopping.Department.SortOrder.get();null==k&&(k=0),c='<li data-role="list-divider" data-theme="a">Sort By</li>',""==b.Code?c+='<li class="psg-shopping-department-indent">Choose a department above to view sort options.</li>':$.each(["Bestselling","Points: Low to High","Points: High to Low"],function(a,b){c+='<li class="psg-shopping-department-indent" '+(a==k?'data-icon="check"':"")+'><a href="#" class="psg_shopping_search_dept_sort" psg-sort-value="'+a+'">'+b+"</a></li>"}),$("#shopping_search_filter_sort").html(c),$("#shopping_search_filter_sort").listview("refresh"),$(".psg_shopping_search_dept_sort").on("click",function(){var a=$(this).attr("psg-sort-value");psgShopping.Department.SortOrder.set(a),psgShopping.Search.Trigger.set(),$("#page_shopping_search_filter").dialog("close")}),$("[name=search_filter_qualifies_radio]").off("click"),$("[name=search_filter_qualifies_radio]").on("click",function(){psg.setSessionItem("shoppingSearchLimit",$(this).attr("value")),psgShopping.Search.Trigger.set(),$("#page_shopping_search_filter").dialog("close")}),$("[name=search_filter_qualifies_radion]").val(psg.getSessionItem("shoppingSearchLimit"))}function page_shopping_onsale_show(){}function page_start_show(){psg.isOpenEnrollment&&$("#start_enroll").attr("href","enrollment.html")}function page_whatsnew_show(){getJson("MOBILE.ANNOUNCEMENTS",function(a){var b="";$.each(a,function(a,c){b+=' <div data-role="collapsible"> 					<h3>'+c.AlternateTitle+"</h3>"+c.Details+"</div>"}),""==b&&(b="<p>There are no announcements at this time.</p><p class=\"ui-alt-title-color\"><small>But don't worry; I'm sure they will come-up with something, soon.</small></p>");var c=$("#psg_collapsible_set_whats_new");c.html(b),$("#psg_collapsible_set_whats_new").collapsibleset("refresh")})}function page_wish_list_show(a){"page_shopping_main"==a?(cache=psg.getCache("wishList",.25),null===cache.data||cache.expired?getJson("SHOPPING.WISHLISTITEMS",HandleGetWishlist):HandleGetWishlist(cache.data)):getJson("SHOPPING.WISHLISTITEMS",HandleGetWishlist)}function HandleGetWishlist(a){var b="",c=[];$.each(a,function(a,d){c.push(d.PercentSaved),b+='<li><img class="ui-product-thumbnail ui-margin-top-1x" src="'+d.ItemSmallImageUrlFullyQualified+'"/>						<h2 id="title_'+d.CatalogItemId+'" class="ui-no-ellipse">'+d.ItemName+'</h2><p><a href="#" data-psg-item-key="'+htmlEncode(JSON.stringify(d.CatalogItemKey))+'" data-transition="slide" class="link-detail">Details</a></p>						<p class="ui-paragraph-padding"><span class="shopPtsStyle">'+d.PointsPerUnitFormatted+'</span> points</p> 						<div  id="psg_jqx_progress_bar_'+a+'" ></div>						<div class="psg-cg"> 						    <button data-psg-key="'+d.CatalogItemId+'"  data-mini="true" class="noCenter ui-btn ui-btn-a ui-icon-delete ui-shadow ui-corner-all">Remove</button> 						    <button data-psg-key="'+d.CatalogItemId+'" data-psg-options="'+htmlEncode(d.OrderOptions)+'"  						    data-psg-points="'+d.PointsPerUnitFormatted+'" data-mini="true" class=" noCenter ui-btn ui-btn-a ui-shadow ui-corner-all " >Move to Cart</button>&nbsp 						</div> 						</li>'
}),""==b&&(b="<li>No items in your wish list.</li>");var d=$("#page_wish_list"),e=$("#psg-listview-wishlist");e.html(b),e.listview("refresh"),e.find(".psg-cg").controlgroup().controlgroup("refresh");for(var f=0,g=0,h=c.length;h>g;g++){f=c[g];var i="#psg_jqx_progress_bar_"+g;d.find(i).jqxProgressBar({width:180,height:23,value:f,showText:!0})}d.find(".jqx-widget-content").css("background-color","#999"),d.find(".jqx-widget-content").css("color","white"),d.find(".jqx-fill-state-pressed").css("background-color","green"),d.find("#psg-listview-wishlist button").on("click",HandleButtonClick),d.find(".link-detail").on("click",function(){psg.setSessionItem("psg-item-key",$(this).attr("data-psg-item-key")),$.mobile.pageContainer.pagecontainer("change","itemdetail.html",{transition:"slide"})})}function HandleButtonClick(a){wishListNextPage="wishlist.html";var b,c=$(a.target).attr("data-psg-key"),d=$(a.target).attr("data-psg-options");if("Move to Cart"==a.target.innerText){if(null!=d&&"null"!=d&&""!=d){var e=$("#title_"+c).html(),f=$(a.target).attr("data-psg-points");return sessionStorage.setItem(getBase()+"add.options",d),sessionStorage.setItem(getBase()+"add.title",e),sessionStorage.setItem(getBase()+"add.key",c),sessionStorage.setItem(getBase()+"add.points",f),wishListNextPage="itemoptions.html",void $.mobile.changePage(wishListNextPage)}b="SHOPPING.WISHLIST.MOVETOCART",wishListNextPage="shoppingcart.html"}else"Remove"==a.target.innerText&&(b="SHOPPING.WISHLIST.REMOVE");var g=JSON.stringify({key:c});getJson(b,HandleWishlistAction,g)}function HandleWishlistAction(a){(null==a.Result||"success"==a.Result)&&("wishlist.html"==wishListNextPage?getJson("SHOPPING.WISHLISTITEMS",HandleGetWishlist):$.mobile.changePage(wishListNextPage))}function page_profile_show(){var a="ENROLLMENT > FIELD";"0"!=psg.participantTypeId&&(a='ENROLLMENT > PARTICIPANT_TYPES[PARTICIPANT_TYPE_ID="'+psg.participantTypeId+'"] > FIELD');var b=ParseFields("profile",a,!0),c=$("#profile_form_div");c.html(b.html),c.append(b.script),c.trigger("create"),getJson("PROFILE.GET",HandleProfileGet,null,function(){history.back()})}function HandleProfileGet(a){if("success"!=a.Result)return ShowAlert("Unable to load profile","Server Error"),void history.back();var b=a.ParticipantDataTable[0];PreFillForm(b,"profile"),$("#frmProfile").validate({submitHandler:submitProfileForm})}function submitProfileForm(){var a=$("#profile_password").val(),b=$("#profile_oldpassword").val();if(""!=a){var c=$("#profile_password_confirm").val();if(a!=c)return ShowAlert("Passwords Do Not Match","Error"),!1;if(""==b)return ShowAlert("You must provide your current password to change to a new one","Error"),!1}var d=$("#frmProfile").serialize(),e=JSON.stringify({form_contents:d});getJson("MOBILE.PROFILE.SAVE",function(a){"success"==a.Result?(ShowAlert("Profile Saved","Success"),$.mobile.pageContainer.pagecontainer("change","home.html")):WriteError(a.Result)},e)}var app={initialize:function(){this.bindEvents()},bindEvents:function(){$(document).ready(this.onDocumentReady),$.isReady&&app.onDocumentReady()},onDocumentReady:function(){psg.init(),$(document).on("pagecreate",PageBeforeCreateManager),$(document).on("pagecontainerbeforetransition",PageBeforeTransitionManager),$(document).on("pagecontainerbeforeshow",PageContainerBeforeShowManager),$.mobile.pageContainer.pagecontainer("change","login.html")},isPhoneGap:!1,offerMobileApp:!1,appName:null,appCompany:null,isOnline:function(){return!0},getHost:function(){return".."},getBase:function(){var a=window.location.pathname.indexOf("/m/")+3;return window.location.pathname.substring(0,a)},standardErrorHandler:function(a,b){return"timeout"==b||"timeout"==a.statusText?void alert("No Internet Connection?\nUnable to reach the server.  Please try again later"):void(401===a.status||404===a.status?$.mobile.pageContainer.pagecontainer("change","timeout.html"):alert("Server Error\n"+a.statusText))}},psgClaimHistory={SelectedClaim:{get:function(){return psg.getSessionItem("claim.history.selectedclaim")},set:function(a){psg.isNothing(a)?psg.removeSessionItem("claim.history.selectedclaim"):psg.setSessionItem("claim.history.selectedclaim",a)}},SelectedPromotion:{get:function(){return psg.getSessionItem("claim.history.selectedpromotion")},set:function(a){psg.isNothing(a)?psg.removeSessionItem("claim.history.selectedpromotion"):psg.setSessionItem("claim.history.selectedpromotion",a)}},Filter:{get:function(){var a=psg.getSessionItem("claim.history.filter");return psg.isNothing(a)?psgClaimHistory.Filter.getDefault():JSON.parse(a)},getDefault:function(){return{PromotionFilter:"0",ClaimFilter:"1"}},set:function(a){psg.setSessionItem("claim.history.filter",JSON.stringify(a))}},Data:{prep:function(a){var b=$.extend({},psgClaimHistory.Data.getDefault(),a);return psg.isNothing(b.Claims)||b.Claims.sort(function(a,b){return!a.claim_date.localeCompare(b.claim_date)}),b},get:function(){var a=psg.getSessionItem("claim.history.data");return psg.isNothing(a)?psgClaimHistory.Data.getDefault():JSON.parse(a)},getDefault:function(){return{Views:[{Key:"1",Value:"All - Not Denied"}],Promotions:[],Goals:[],Claims:[]}},set:function(a){psg.setSessionItem("claim.history.data",JSON.stringify(a))}},getLastClaims:function(a,b){return psg.isNothing(a)?[]:(psg.isNothing(b)&&(b=3),a.slice(0,Math.min(a.length,b)))},buildClaimList:function(a){if(psg.isNothing(a))return"";for(var b,c,d="",e=0;e<a.length;e++)b=a[e],d+='<li><a href="claimdetail.html" class="psg-claim-item" data-transition="slide" psg-claim-id="',d+=b.claim_id.toString(),d+='"><div class="ui-overlay-container"><div class="ui-no-ellipse ui-text-small"><strong>',d+=b.promotion_name,d+='</strong></div><div class="ui-text-small"><table>',psg.isNothing(b.invoice_number)||(d+='<tr><td class="ui-form-label">Invoice</td><td class="ui-form-field">',d+=b.invoice_number,d+="</td></tr>"),d+='<tr><td class="ui-form-label">Product</td><td class="ui-form-field">',d+=b.product_name,psg.isNothing(b.is_claim_split)||1!==b.is_claim_split||(d+='<small style="margin-left:1.5em;">Claim Split</small>'),d+="</td></tr>",d+='<tr><td class="ui-form-label">Claim Date</td><td class="ui-form-field">',d+=moment(b.claim_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),d+="</td></tr>",d+='<tr><td class="ui-form-label">Sale Date</td><td class="ui-form-field">',d+=moment(b.sale_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),d+="</td></tr>",d+='<tr><td class="ui-form-label">Quantity</td><td class="ui-form-field">',d+=b.quantity.toString(),d+="</td></tr>",!psg.isNothing(b.promotion_basis)&&b.promotion_basis>=20&&(d+='<tr><td class="ui-form-label">Amount</td><td class="ui-form-field">',d+=psg.NumberUtil.toCurrency(b.sale_amount),d+="</td></tr>"),d+='<tr><td class="ui-form-label">Payout</td><td class="ui-form-field">',c=psg.isNothing(b.status_type_id)||0!==b.status_type_id?b.payout:b.amount_paid,d+=psg.isNothing(b.payout_type)||1!==b.payout_type?psg.NumberUtil.toPoints(c):psg.NumberUtil.toCurrency(c),d+="</td></tr>",d+='</table></div><div class="ui-no-ellipse ui-text-small ui-text-right ui-claim-status ui-underlay"><div class="ui-claim-status">',d+=b.claim_status,psg.isNothing(b.status_type_id)||0!==b.status_type_id||(d+="<br />"+moment(b.date_paid1_jdate,"MM-DD-YYYY").format("MM-DD-YYYY")),d+="</div></div></div></a></li>";return d},buildClaimDetail:function(a){if(psg.isNothing(a))return"";var b="";switch(b+='<h3 class="headerDivider">'+a.promotion_name+"</h3>",b+="<h4>Claim ID: "+a.claim_id.toString()+"</h4>",b+='<ul id="psg-listview-claimdetail-status" data-role="listview" data-theme="a" data-divider-theme="a" data-inset="false"><li data-role="list-divider">Claim Status</li><li class="ui-field-contain"><label for="psg-claim-detail-claim-date" class="ui-text-small">Claim Date:</label><span id="psg-claim-detail-claim-date">',b+=moment(a.claim_date_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+='</span></li><li class="ui-field-contain"><label for="psg-claim-detail-claim-status" class="ui-text-small">Claim Status:</label><span id="psg-claim-detail-claim-status">',b+=a.claim_status,b+="</span></li>",a.status_type_id){case 0:b+='<li class="ui-field-contain"><label for="psg-claim-detail-paid-date" class="ui-text-small">Approved Date:</label><span id="psg-claim-detail-paid-date">',b+=moment(a.date_paid_jdate,"MM-DD-YYYY").format("MM-DD-YYYY"),b+='</span></li><li class="ui-field-contain"><label for="psg-claim-detail-paid-amount" class="ui-text-small">Award Amount:</label><span id="psg-claim-detail-paid-amount">',b+=psg.isNothing(a.payout_type)||1!==a.payout_type?psg.NumberUtil.toPoints(a.amount_paid):psg.NumberUtil.toCurrency(a.amount_paid),b+="</span></li>";break;default:b+='<li class="ui-field-contain"><label for="psg-claim-detail-payout" class="ui-text-small">Payout:</label><span id="psg-claim-detail-payout">',b+=psg.isNothing(a.payout_type)||1!==a.payout_type?psg.NumberUtil.toPoints(a.payout):psg.NumberUtil.toCurrency(a.payout),b+="</span></li>"}b+="</ul>",b+='<ul id="psg-listview-claimdetail-details" data-role="listview" data-theme="a" data-divider-theme="a" data-inset="false"><li data-role="list-divider">Details</li>';var c=["invoice_number","product_name","sale_date","quantity","sale_amount","dealer_code","distributor_code","serial_number","receiver_serial","consumer_full_name","consumer_company","wholesaler_name","consumer_line_one","consumer_line_two","consumer_city","consumer_state","consumer_zip","consumer_phone_number"],d=["Invoice","Product","Sale Date","Quantity","Sale Amount","Dealer","Distributor","Serial Number","Receiver Serial","Consumer","Company","Wholesaler","Address 1","Address 2","City","State","Zip","Phone"];return $.each(c,function(c,e){var f=a[e];psg.isNothing(f)||(b+='<li class="ui-field-contain"><label for="psg-claim-detail-invoice" class="ui-text-small">',b+=d[c],b+=':</label><span id="psg-claim-detail-invoice">',e.indexOf("jdate")>-1?b+=moment(f,"MM-DD-YYYY").format("MM-DD-YYYY"):"quantity"===e?(b+=psg.NumberUtil.toNumber(f,2),psg.isNothing(a.uom)||(b+="&nbsp;"+uom)):b+="sale_amount"===e?psg.NumberUtil.toCurrency(f):f,b+="</span></li>")}),b+="</ul>"}},itemDetails={ispuValue:null,ispuKey:null,show:function(){var a=this;this.ispuValue=null,this.ispuKey=null;var b=sessionStorage.getItem(getBase()+"psg-item-key");getJson("SHOPPING.DETAIL",function(b){a.HandleGetShoppingDetail(b)},{key:b}),$("#psg_item_detail_cart").on("click",function(){var b="";if($("#psg_detail_item_options").length&&!psg.isNothing($("#psg_detail_item_options").attr("data-psg-id"))){var c=$("#psg_detail_item_options").attr("data-psg-id"),d=$("#psg_detail_item_options option:selected").val();b=c+"="+d+";"}var e=sessionStorage.getItem(getBase()+"psg-item-key");getJson("SHOPPING.CART.ADD",function(b){a.HandleItemDetailAddCallback(b,"shoppingcart.html")},{key:e,selectedOrderOptions:b})}),$("#psg_item_detail_wishlist").on("click",function(){var b=sessionStorage.getItem(getBase()+"psg-item-key");getJson("SHOPPING.WISHLIST.ADD",function(b){a.HandleItemDetailAddCallback(b,"wishlist.html")},{key:b})})},HandleItemDetailAddCallback:function(a,b){null==a.Result||"success"==a.Result?$.mobile.pageContainer.pagecontainer("change",b):WriteError(a.Result)},HandleGetShoppingDetail:function(a){var b=this;if(null==a.Result||"success"==a.Result){if($("#psg_detail_item_title").html(a.Item.ItemName),$("#psg_detail_item_url").attr("src",a.Item.ItemMediumImageUrlFullyQualified),$("#psg_detail_item_points").html('<span class="shopPtsStyle">'+a.Item.PointsPerUnitFormatted+"</span> points"),$("#psg_item_detail_text").html(a.Item.ItemText),app.isPhoneGap&&$("#psg_item_detail_text").on("click","a",function(a){a.preventDefault(),window.open($(this).attr("href"),"_system")}),a.Item.IsOnSale&&($("#psg_detail_onsale_info").show(),a.Sale)){var c="Regular Price&nbsp;"+a.Sale.RegularPointsPerUnitWithLabel;$("#psg_detail_item_regular_price").html(c)}if(null!=a.Item.OrderOptions&&""!=a.Item.OrderOptions){var d=a.Item.PointsPerUnitFormatted.indexOf("From")>-1?!0:!1,e=$.parseXML(a.Item.OrderOptions),f=$(e),g=f.find("OptionList > DropDownList").attr("Label"),h=$("#psg_item_options");h.addClass("ui-field-contain"),h.html('<label for="psg_detail_item_options">'+g+"</label>");var i=f.find("OptionList > DropDownList").attr("ID");if(h.append('<select id="psg_detail_item_options" data-psg-id="'+i+'"></select>'),f.find("OptionList > DropDownList > ListItem").each(function(){var a=$(this),c=a.attr("TotalPoints");optionString='<option value="'+a.attr("Value")+'" class="ui-no-ellipse">'+a.attr("Text"),d&&(optionString.indexOf("/")>-1&&(optionString+=" /"),optionString+=" "+addCommas(c)+" Points"),optionString+="</option>",$("#psg_detail_item_options").append(optionString),"In-Store Pickup"==a.attr("Text")&&(b.ispuValue=a.attr("Value"))}),$("#psg_detail_item_options").selectmenu().selectmenu("refresh").on("change",function(){b.detailChangeDeliveryOption(this)}),app.isPhoneGap&&$(".cart_desktop_link").click(function(){return window.open(psg.baseUrl+"/Cart.aspx","_system"),!1}),null!=this.ispuValue){var j=this.ispuValue.lastIndexOf("_");if(j>0){this.ispuKey=this.ispuValue.substring(j+1);var a=JSON.stringify({sku:this.ispuKey});getJson("ISPU.STORES.GET",function(a){b.HandleGetIpuStoreList(a)},a)}}}}else WriteError(a.Result)},HandleGetIpuStoreList:function(a){var b="";null==a.Result||"success"==a.Result?$.each(a.Stores,function(a,c){b+="<li>"+c.StoreName+"<br><span style='font-size:small;'>"+c.StoreAvailabilityMessage+"</span></li>"}):b="<li>No stores found.</li>",$("#ispu_store_list").html(b),$("#ispu_store_list").listview("refresh"),this.detailChangeDeliveryOption($("#psg_detail_item_options")),$("#ispu_store_panel_search").hide(),$("#ispu_store_panel_more").show()},detailChangeDeliveryOption:function(a){$(a).val()==this.ispuValue?$("#psg_ispu_info").show():$("#psg_ispu_info").hide()},detailShowStores:function(){$("#ispu_store_panel_search").hide(),$("#ispu_store_panel_more").show(),$("#ispu_store_panel").panel("open")},detailDismissStores:function(){$("#ispu_store_panel").panel("close")},detailCheckMoreStores:function(){$("#ispu_store_panel_more").hide(),$("#ispu_store_panel_search").show()},detailShowMoreStores:function(){$("#detailMoreStoresZip").blur();var a=this,b={sku:this.ispuKey},c=$("#detailMoreStoresZip").val();c.length>0&&(b.zip=c),$("#ispu_store_list").html("<li>Looking for stores in<br>"+(""==c?" your zip code":c)+"</li>"),$("#ispu_store_list").listview("refresh"),getJson("ISPU.STORES.GET",function(b){a.HandleGetIpuStoreList(b)},b)},detailSearchKeyPress:function(a){13==a.which&&($(a.target).blur(),this.detailShowMoreStores())},storeSearchMouse:function(){$("#detailMoreStoresZip").blur(),this.detailShowMoreStores()},moreStoresZipBlur:function(){setTimeout(function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop)},0)}},psgShopping={Department:{Current:{get:function(){return JSON.parse(psg.getSessionItem("shopping.department.current"))},reset:function(){psg.removeSessionItem("shopping.department.lineage"),psg.removeSessionItem("shopping.department.current")},set:function(a){if(psg.isNothing(a)||""==a.Code)return psg.removeSessionItem("shopping.department.lineage"),void psg.removeSessionItem("shopping.department.current");var b=psgShopping.Department.Current.get(),c=JSON.parse(psg.getSessionItem("shopping.department.lineage"));if(psg.isNothing(c)||""==c.Code)psg.isNothing(b)||(c=[b]);else{var d=$.grep(c,function(b){return!psg.isNothing(b)&&b.Code==a.Code});psg.isNothing(d)?c[c.length]=b:c.length=c.indexOf(d[0])}psg.setSessionItem("shopping.department.current",JSON.stringify(a)),psg.setSessionItem("shopping.department.lineage",JSON.stringify(c))}},Parent:{get:function(){var a=JSON.parse(psg.getSessionItem("shopping.department.lineage"));return psg.isNothing(a)?null:a[a.length-1]}},SortOrder:{get:function(){function a(a){return psg.isNothing(a)?0:a}return a(psg.getSessionItem("shopping.department.sortorder"))},set:function(a){psg.setSessionItem("shopping.department.sortorder",a)}}},Departments:{get:function(){return JSON.parse(psg.getSessionItem("shopping.departments"))},set:function(a){psg.setSessionItem("shopping.departments",JSON.stringify(a))},isTop:function(a){return top=psgShopping.Departments.get(),psg.isNothing(top)?!1:top.indexOf(a)>-1}},Search:{DepartmentCounts:{get:function(){return JSON.parse(psg.getSessionItem("shopping.search.departmentcounts"))},set:function(a){psg.setSessionItem("shopping.search.departmentcounts",JSON.stringify(a))}},go:function(){var a=psgShopping.Department.Current.get(),b=$("#psg_search_keyword").val();if(psg.isNothing(a)&&""==b)return void $("#psg_search_keyword").focus().attr("placeholder","Enter search term");""==b?psgShopping.Search.Mode.reset():psgShopping.Search.Mode.set(),psgShopping.Search.Term.set(b);var c=psgShopping.Department.SortOrder.get(),d="yes"==psg.getSessionItem("shoppingSearchLimit")?psg.getSessionItem("balance_number"):0;null==d&&(d=0),$("#psg_listview_search").html("");var e=JSON.stringify({categoryCode:psg.isNothing(a)?"":a.Code,keywords:b,pageIndex:0,sort:Number(c),minPoints:0,maxPoints:Number(d)});getJson("SHOPPING.SEARCH",HandleGetSearch,e,null,2e4)},Mode:{reset:function(){psg.removeSessionItem("shopping.search.mode")},set:function(){psg.setSessionItem("shopping.search.mode",!0)},isSet:function(){return!psg.isNothing(psg.getSessionItem("shopping.search.mode"))}},PageIndex:{get:function(){function a(a){return psg.isNothing(a)?0:a}return a(psg.getSessionItem("shopping.search.pageindex"))},set:function(a){psg.setSessionItem("shopping.search.pageindex",a)}},Term:{get:function(){return psg.getSessionItem("shopping.search.term")},set:function(a){psg.isNothing(a)?psg.removeSessionItem("shopping.search.term"):psg.setSessionItem("shopping.search.term",a)}},Trigger:{reset:function(){psg.removeSessionItem("shopping.search.trigger")},set:function(){psg.setSessionItem("shopping.search.trigger",!0)},isSet:function(){return!psg.isNothing(psg.getSessionItem("shopping.search.trigger"))}}}},wishListNextPage;